sudo: required
language: generic
services:
  - docker
env:
  global:
    - GITHUB_REPO: jcayouette/test-suma
    - secure: "Ua/qo1Ou32rv+Oa0Xop+FKu4OpPT6fBRaARjTBuMHKrdWW9jy/8sKc9GIH/bwakWjxSYlp2I/JdUURaXUBPkxcevHEgrkNT1FQzfoHZfsaBQO6zTGzIzO2lQ0NVpPvrK0Ky/LFhRTuJ/MiTjudFXvi9M+ZRYLdbq2TOMyD6gwhd73aJX/GitASr/GsRWkaX9xAjXeTfeFc4GJdGwhkkLZL8PrWbc077Pzp+kkGAtqpZx0/jJu3+At38z5X+CvU9gvMmMJp9ygKHuuLSvBum+19zWbBjZI0KfWSgETtj76ps2ABOPdrmkDzn00UJQ/nqdc3Zc+PrKhcXO0Py5GBe/0D1NwXM1fbUH2m2tMp7ZR3Tvw8UMiDFxPZgy0roA+FtfWTVyPW2UDOFbQh9NMI0YylYGuBAE4yW2XZhZ+E0H98Zvr5M0waSMc5fv1hKHgaCkF6+/mqCr0DU69i97qwnlokaWkQnQV0o/YRGiH7a4jBQSkfBGdD9P3A33oiu4E84Xok3VKeRzFfJAmfOZen+aWccPmqZ9sxgrzWlnx4McrYpKHpENadnyepiT8mLwdKM5Ar8wrGUROcMzCuslhx/SSN/o9jgFL86KsOrx2z9U27VSVAiJQkYgOy6Y7WKbNJ4gMnyz31IkYwIe7HsA5bxFuLnklFK8fB6TM8ll09mwSJw="

before_install:
  - git clone --depth 100 https://github.com/jcayouette/test-suma -b master
  #- git clone --depth 100 https://github.com/jcayouette/test-suma -b gh-pages
  - cd test-suma/
  # Get latest changes
  - git fetch --all
  - git pull -ff
  # checkout gh page branch
  - git checkout gh-pages
  # remove content
  - rm -rf suse-manager/ pdf/ _/ 404.html _headers index.html robots.txt search-index.js sitemap.xml susemanager-docs_en-pdf.tar.gz
  #- git clone --depth 1 https://github.com/jcayouette/doc-susemanager-publisher
  #- cd doc-susemanager-publisher
  - docker pull antora/antora:latest
  - docker run -u $UID -v `pwd`:/antora --rm -t antora/antora:latest --cache-dir=./.cache/antora suma-site.yml
  #- cp -r public/uyuni/ia-rework-builder ../uyuni/
  - cp -r public/suse-manager/ ../suse-manager/
  - cd ../
  - git pull
  - git remote rm origin
  - git remote add origin https://${GITHUB_TOKEN}@github.com/jcayouette/test-suma -m gh-pages
  - git fetch --all
  - git pull -ff
  - git add .
  - git commit -am "New travis commit to gh-pages"
  - git push --set-upstream origin gh-pages
